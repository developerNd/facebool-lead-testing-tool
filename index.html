<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook Lead Ads Testing Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .animate-spin-slow { animation: spin 3s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .json-pre::-webkit-scrollbar { width: 6px; height: 6px; }
        .json-pre::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-4 md:p-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
            <!-- Header -->
            <div class="bg-blue-600 p-8 text-white">
                <div class="flex items-center gap-4">
                    <div class="bg-white/20 p-3 rounded-xl backdrop-blur-sm">
                        <i data-lucide="send" class="w-8 h-8"></i>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold tracking-tight">Facebook Lead Ads Testing Tool</h1>
                        <p class="text-blue-100 mt-1 opacity-90 text-sm md:text-base">Simulate and verify your Lead Ads integration in seconds</p>
                    </div>
                </div>
            </div>

            <div class="p-8 space-y-8">
                <!-- Requirements Section -->
                <div class="bg-blue-50 border-l-4 border-blue-500 p-5 rounded-r-lg">
                    <div class="flex items-start gap-3">
                        <i data-lucide="info" class="text-blue-600 mt-1 flex-shrink-0 w-5 h-5"></i>
                        <div>
                            <h2 class="font-bold text-blue-900 mb-2">Before you start</h2>
                            <ul class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2 text-sm text-blue-800">
                                <li class="flex items-center gap-2"><span class="w-1.5 h-1.5 bg-blue-400 rounded-full"></span>Page Token with leads_retrieval</li>
                                <li class="flex items-center gap-2"><span class="w-1.5 h-1.5 bg-blue-400 rounded-full"></span>Page role Advertiser or higher</li>
                                <li class="flex items-center gap-2"><span class="w-1.5 h-1.5 bg-blue-400 rounded-full"></span>No existing test leads for this form</li>
                                <li class="flex items-center gap-2"><span class="w-1.5 h-1.5 bg-blue-400 rounded-full"></span>Form should not be in production</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Input Form -->
                <div class="grid grid-cols-1 gap-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="md:col-span-1">
                            <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
                                <i data-lucide="code" class="w-4 h-4 text-gray-400"></i> API Version
                            </label>
                            <select id="apiVersion" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white shadow-sm outline-none transition-all">
                                <option value="v20.0">v20.0 (Latest)</option>
                                <option value="v19.0">v19.0</option>
                                <option value="v18.0">v18.0</option>
                                <option value="v17.0">v17.0</option>
                            </select>
                        </div>

                        <div class="md:col-span-3">
                            <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
                                <i data-lucide="help-circle" class="w-4 h-4 text-gray-400"></i> Form ID <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="formId" placeholder="e.g. 123456789012345" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent shadow-sm outline-none transition-all font-mono">
                            <p class="text-[10px] text-gray-400 mt-2 italic">Found in Business Suite or Lead Ads Forms manager.</p>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
                            <i data-lucide="key" class="w-4 h-4 text-gray-400"></i> Page Access Token <span class="text-red-500">*</span>
                        </label>
                        <textarea id="accessToken" placeholder="Paste your long-lived or session Page Access Token here..." rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm shadow-sm outline-none transition-all"></textarea>
                    </div>

                    <button id="createBtn" class="w-full py-4 px-6 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold text-lg transition-all flex items-center justify-center gap-3 shadow-lg hover:shadow-xl active:scale-[0.98] disabled:bg-gray-200 disabled:text-gray-400 disabled:shadow-none disabled:cursor-not-allowed">
                        <i data-lucide="send" class="w-6 h-6"></i>
                        <span id="btnText">Create Test Lead</span>
                    </button>
                </div>

                <!-- Error Feedback -->
                <div id="errorBox" class="hidden">
                    <div class="bg-red-50 border-l-4 border-red-500 p-5 rounded-r-lg">
                        <div class="flex items-start gap-4">
                            <i data-lucide="x-circle" class="text-red-600 flex-shrink-0 w-6 h-6"></i>
                            <div class="flex-1">
                                <h3 class="font-bold text-red-800">API Error</h3>
                                <p id="errorMessage" class="text-red-700 text-sm mt-1 leading-relaxed"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Response Section -->
                <div id="responseBox" class="hidden">
                    <div id="responseStatus" class="border-l-4 p-6 rounded-r-lg shadow-sm">
                        <div class="flex items-start gap-4">
                            <div id="statusIconBg" class="p-2 rounded-full">
                                <i id="statusIcon" class="w-6 h-6"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 id="responseTitle" class="text-lg font-bold"></h3>
                                    <span id="httpStatus" class="px-3 py-1 text-xs font-bold rounded-full uppercase tracking-wider"></span>
                                </div>
                                
                                <div class="bg-white rounded-xl border border-gray-200 overflow-hidden shadow-inner">
                                    <div class="bg-gray-50 px-4 py-2 border-b border-gray-200 flex items-center justify-between">
                                        <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest font-mono">JSON Response</span>
                                        <button id="copyBtn" class="text-blue-600 hover:text-blue-800 text-xs font-medium transition-colors">Copy</button>
                                    </div>
                                    <pre id="jsonDisplay" class="p-4 text-xs font-mono text-gray-800 overflow-x-auto whitespace-pre-wrap leading-relaxed max-h-60 overflow-y-auto json-pre"></pre>
                                </div>

                                <div id="detailsAction" class="mt-6 hidden flex items-center gap-4">
                                    <button id="fetchDetailsBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-xl text-sm transition-all shadow-md hover:shadow-lg flex items-center gap-2">
                                        <i data-lucide="info" class="w-4 h-4"></i>
                                        Fetch Full Lead Details
                                    </button>
                                    <span id="leadIdBadge" class="text-xs text-green-700 font-medium italic opacity-70"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Documentation -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 pt-8 border-t border-gray-100">
                    <section>
                        <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <i data-lucide="external-link" class="w-5 h-5 text-blue-500"></i>
                            Auth Guide
                        </h3>
                        <div class="space-y-3 text-sm text-gray-600 leading-relaxed bg-slate-50 p-6 rounded-2xl border border-slate-100">
                            <ol class="list-decimal list-inside space-y-3">
                                <li>Visit <a href="https://developers.facebook.com/tools/explorer/" target="_blank" class="text-blue-600 hover:underline font-medium">Graph API Explorer</a></li>
                                <li>Select App & <span class="font-semibold">Get Page Access Token</span>.</li>
                                <li>Enable: <code class="bg-white border px-1 rounded text-xs text-blue-700 font-mono">leads_retrieval</code>, <code class="bg-white border px-1 rounded text-xs text-blue-700 font-mono">pages_manage_ads</code>.</li>
                                <li>Copy and paste token above.</li>
                            </ol>
                        </div>
                    </section>

                    <section>
                        <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <i data-lucide="code" class="w-5 h-5 text-blue-500"></i>
                            Endpoint Reference
                        </h3>
                        <div class="bg-slate-900 text-slate-300 p-6 rounded-2xl font-mono text-[11px] leading-relaxed">
                            <div class="mb-2 text-slate-500 text-[10px] uppercase tracking-widest font-bold">Meta Graph Request</div>
                            <p><span class="text-pink-400 font-bold">POST</span> /v20.0/{FORM_ID}/test_leads</p>
                            <div class="pt-2 mt-2 border-t border-slate-800 opacity-60">
                                curl -X POST "https://graph.facebook.com/v20.0/FORM_ID/test_leads?access_token=TOKEN"
                            </div>
                        </div>
                    </section>
                </div>
            </div>

            <!-- Footer -->
            <div class="bg-gray-50 border-t border-gray-100 p-6 text-center">
                <p class="text-[10px] text-gray-400 font-medium tracking-wide">
                    Meta Marketing API Development Utility â€¢ v2.1.0
                </p>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const formIdInput = document.getElementById('formId');
        const tokenInput = document.getElementById('accessToken');
        const versionSelect = document.getElementById('apiVersion');
        const createBtn = document.getElementById('createBtn');
        const btnText = document.getElementById('btnText');
        const errorBox = document.getElementById('errorBox');
        const errorMessage = document.getElementById('errorMessage');
        const responseBox = document.getElementById('responseBox');
        const responseStatus = document.getElementById('responseStatus');
        const statusIcon = document.getElementById('statusIcon');
        const statusIconBg = document.getElementById('statusIconBg');
        const responseTitle = document.getElementById('responseTitle');
        const httpStatus = document.getElementById('httpStatus');
        const jsonDisplay = document.getElementById('jsonDisplay');
        const copyBtn = document.getElementById('copyBtn');
        const detailsAction = document.getElementById('detailsAction');
        const fetchDetailsBtn = document.getElementById('fetchDetailsBtn');
        const leadIdBadge = document.getElementById('leadIdBadge');

        let lastResponseData = null;

        // Initialize Lucide Icons
        lucide.createIcons();

        // Validation & Button State
        const validate = () => {
            const isValid = formIdInput.value.trim() !== '' && tokenInput.value.trim() !== '';
            createBtn.disabled = !isValid;
        };

        formIdInput.addEventListener('input', validate);
        tokenInput.addEventListener('input', validate);

        // Core API Logic
        const setUIState = (loading) => {
            if (loading) {
                createBtn.disabled = true;
                btnText.textContent = 'Processing...';
                createBtn.querySelector('i').classList.add('animate-spin');
            } else {
                createBtn.disabled = false;
                btnText.textContent = 'Create Test Lead';
                createBtn.querySelector('i').classList.remove('animate-spin');
                validate();
            }
        };

        const createTestLead = async () => {
            const formId = formIdInput.value.trim();
            const token = tokenInput.value.trim();
            const version = versionSelect.value;

            setUIState(true);
            errorBox.classList.add('hidden');
            responseBox.classList.add('hidden');

            try {
                const url = `https://graph.facebook.com/${version}/${formId}/test_leads`;
                const res = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ access_token: token })
                });

                const data = await res.json();
                lastResponseData = data;

                if (res.ok) {
                    showResponse(true, data, 'Lead Created Successfully', 'HTTP 200');
                } else {
                    const msg = data.error?.message || 'Failed to create test lead';
                    showError(msg);
                    showResponse(false, data, 'Response Received', 'Error');
                }
            } catch (err) {
                showError(err.message || 'An unexpected error occurred');
            } finally {
                setUIState(false);
            }
        };

        const fetchLeadDetails = async (leadId) => {
            const version = versionSelect.value;
            const token = tokenInput.value.trim();
            
            setUIState(true);
            try {
                const url = `https://graph.facebook.com/${version}/${leadId}?fields=field_data,ad_name,campaign_name&access_token=${token}`;
                const res = await fetch(url);
                const data = await res.json();
                
                showResponse(res.ok, data, res.ok ? 'Full Lead Details' : 'Details Fetch Error', res.ok ? 'HTTP 200' : 'Error');
                detailsAction.classList.add('hidden');
            } catch (err) {
                showError(err.message);
            } finally {
                setUIState(false);
            }
        };

        // UI Updates
        const showError = (msg) => {
            errorMessage.textContent = msg;
            errorBox.classList.remove('hidden');
            errorBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
        };

        const showResponse = (success, data, title, statusLabel) => {
            responseBox.classList.remove('hidden');
            
            // Success/Warning styles
            if (success) {
                responseStatus.className = 'border-l-4 p-6 rounded-r-lg shadow-sm bg-green-50 border-green-500';
                statusIconBg.className = 'p-2 rounded-full bg-green-100';
                statusIcon.setAttribute('data-lucide', 'check-circle');
                statusIcon.className = 'w-6 h-6 text-green-600';
                responseTitle.className = 'text-lg font-bold text-green-800';
                httpStatus.className = 'px-3 py-1 text-xs font-bold rounded-full uppercase tracking-wider bg-green-200 text-green-800';
            } else {
                responseStatus.className = 'border-l-4 p-6 rounded-r-lg shadow-sm bg-amber-50 border-amber-500';
                statusIconBg.className = 'p-2 rounded-full bg-amber-100';
                statusIcon.setAttribute('data-lucide', 'info');
                statusIcon.className = 'w-6 h-6 text-amber-600';
                responseTitle.className = 'text-lg font-bold text-amber-800';
                httpStatus.className = 'px-3 py-1 text-xs font-bold rounded-full uppercase tracking-wider bg-amber-200 text-amber-800';
            }

            responseTitle.textContent = title;
            httpStatus.textContent = statusLabel;
            jsonDisplay.textContent = JSON.stringify(data, null, 2);
            
            // Check for lead ID to show fetch details button
            if (success && data.id) {
                detailsAction.classList.remove('hidden');
                leadIdBadge.textContent = `ID: ${data.id}`;
                fetchDetailsBtn.onclick = () => fetchLeadDetails(data.id);
            } else {
                detailsAction.classList.add('hidden');
            }

            lucide.createIcons();
            responseBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
        };

        // Event Listeners
        createBtn.addEventListener('click', createTestLead);
        
        copyBtn.addEventListener('click', () => {
            if (jsonDisplay.textContent) {
                navigator.clipboard.writeText(jsonDisplay.textContent);
                const originalText = copyBtn.textContent;
                copyBtn.textContent = 'Copied!';
                copyBtn.classList.add('text-green-600');
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.classList.remove('text-green-600');
                }, 2000);
            }
        });

    </script>
</body>
</html>